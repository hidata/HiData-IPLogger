# HiData IP Logger for WHMCS

افزونه حرفه‌ای و سبک برای ثبت ردپای IP مشتریان در رویدادهای امنیتی مهم WHMCS.

## امکانات
- ثبت ورود، تغییر رمز، تغییر ایمیل و درخواست لغو سرویس با IP و User Agent.
- ذخیره در جدول اختصاصی `mod_iplogger` با ستون‌های: `id`, `client_id`, `action`, `ip`, `asn`, `country`, `agent`, `time` و جدول پیکربندی `mod_iplogger_conf` برای نگهداری تنظیمات افزونه.
- پنل مدیریت فارسی با جستجو و صفحه تنظیمات جداگانه (فعال/غیرفعال کردن رویدادها و نگهداری).
- باکس «IP Logs» در صفحه خلاصه مشتری (clientssummary.php) با نمایش سریع لاگ‌های همان مشتری و شمارنده اشتراک IP بین مشتریان.
- پاک‌سازی خودکار بر اساس مدت نگهداری و غنی‌سازی کشور/ISP (با countryCode) با کرون ساعتی.

## نصب
1. پوشه `modules/addons/iplogger` را در مسیر WHMCS آپلود کنید.
2. در ناحیه مدیریت WHMCS از مسیر **System Settings > Addon Modules** افزونه «HiData IP Logger» را فعال کنید.
3. سطح دسترسی ادمین مناسب (Configure Addon Modules یا View Clients) را برای ماژول تنظیم کنید.
4. پس از فعال‌سازی، دکمه «تنظیمات» داخل ماژول برای فعال/غیرفعال کردن رویدادها و تعیین مدت نگهداری در دسترس است.

## نکات امنیتی
- تمام خروجی‌ها escape شده‌اند تا از XSS جلوگیری شود.
- تمام کوئری‌ها از Query Builder پارامتری WHMCS استفاده می‌کنند.
- دسترسی به ماژول و باکس ادمینی نیازمند ادمین لاگین با دسترسی مناسب است.
- Pagination و محدودیت تعداد نتایج در لیست اصلی پیاده‌سازی شده است.

## کرون
کرون WHMCS (ساعتی) به‌صورت خودکار:
- رکوردهای قدیمی‌تر از مدت نگهداری را حذف می‌کند (اگر > 0 باشد).
- رکوردهای بدون کشور/ISP را با استفاده از `ip-api.com` (countryCode/isp) تکمیل می‌کند (حداکثر 20 رکورد در هر اجرا).
